# api

This application is an accountability app meant for keeping track of yearly, monthly and weekly goals.
Goals can be set by a user or their accountability buddy. Based on a process I have with my accountability
buddy.

## Installation

Requirements:

clojure

docker 

babashka

    $ bash < <(curl -s https://raw.githubusercontent.com/babashka/babashka/master/install)

## Running locally

Set up local postgres with

```bb set-db```

Run the project directly, via `:main-opts` (`-m goals.api`):

    $ clojure -M:run-m

Integration tests require a test db. To run them run:
    bb test

Run the project's CI pipeline and build an uberjar:

    $ clojure -T:build ci

This will produce an updated `pom.xml` file with synchronized dependencies inside the `META-INF`
directory inside `target/classes` and the uberjar in `target`. You can update the version (and SCM tag)
information in generated `pom.xml` by updating `build.clj`.

If you don't want the `pom.xml` file in your project, you can remove it. The `ci` task will
still generate a minimal `pom.xml` as part of the `uber` task, unless you remove `version`
from `build.clj`.

Run that uberjar:

    $ java -jar target/api-0.1.0-SNAPSHOT.jar

If you remove `version` from `build.clj`, the uberjar will become `target/api-standalone.jar`.

## Current state
1. an authenticated user can add and complete goals for themselves
    - done:
        adding goals
        basic authentication
        completing goals
    - todo:
        based on a level the deadline is created

Link to the board with the rest of the plan https://miro.com/app/board/uXjVP0G5xQU=/?share_link_id=472777659691

## Deployment
make a jar with
bb build
<!--18.170.226.130 or whichever IP I have -->
rsync api-0.1.0-SNAPSHOT.jar ubuntu@18.170.226.130:goals.jar
ssh ubuntu@18.170.226.130
sudo apt update 
sudo apt install default-jre
java -version
sudo apt install postgresql postgresql-contrib
sudo -i -u postgres
createuser --interactive
psql
ALTER USER goals with password 'goals';
createdb goals
(quit psql user)
sudo vim /etc/systemd/system/goals.service

[Unit]
Description=goals service
After=network.target
StartLimitIntervalSec=0
[Service]
Type=simple
Restart=always
RestartSec=1
ExecStart=java -jar /home/ubuntu/goals.jar

[Install]
WantedBy=multi-user.target

sudo systemctl daemon-reload 
sudo systemctl enable goals.service 
sudo systemctl start goals.service 
sudo systemctl status goals.service 

## License

Copyright Â© 2023 Agatasumowska

_EPLv1.0 is just the default for projects generated by `clj-new`: you are not_
_required to open source this project, nor are you required to use EPLv1.0!_
_Feel free to remove or change the `LICENSE` file and remove or update this_
_section of the `README.md` file!_

Distributed under the Eclipse Public License version 1.0.




Questions:
one transaction for two rows? resiliance!